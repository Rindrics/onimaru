# 0012. クライアント側キャッシュの実装方法

## Status
Accepted

## Context
`/api/stats` はParquetファイルを読み込んでレコード数をカウントするため、レスポンスに時間がかかる。毎回APIにアクセスすると、ユーザー体験が悪化する。データ更新頻度は毎日1回（[ref](./0007-バッチ処理の実装方法.md)）であるため、キャッシュが有効。

## Decision
クライアント側でグローバル変数を使用したキャッシュ方式を選択する。キャッシュの有効期限は1日間とする。

## Consequences
- **メリット**
  - 実装がシンプルで追加のライブラリが不要
  - ページが再マウントされてもキャッシュが保持される
  - データ更新頻度（毎日1回）と整合性が取れている
  - ブラウザのキャッシュ（`fetch`の`cache: 'force-cache'`）も併用
- **デメリット**
  - ページをリロードするとキャッシュが失われる（ただし、ブラウザキャッシュで補完）
  - 複数のタブで開いた場合、各タブで独立したキャッシュを持つ
  - より高度な機能（自動再検証、エラー時の再試行など）は提供しない

## 実装方針
- グローバル変数（`cachedStats`, `cacheTimestamp`）でキャッシュを保持
- キャッシュの有効期限は1日間（`24 * 60 * 60 * 1000`ミリ秒）
- キャッシュが有効な場合はAPIを呼び出さず、即座にデータを表示
- キャッシュが無効な場合のみAPIを呼び出し、キャッシュを更新

## 将来の拡張について
より高度なキャッシュ機能が必要な場合（自動再検証、エラー時の再試行、複数タブ間での同期など）は、SWRやReact Queryなどのライブラリの導入を検討する。

