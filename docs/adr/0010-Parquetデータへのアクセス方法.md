# 0010. Parquet データへのアクセス方法

## Status

Accepted

## Context

データはParquet形式で配信するが（[ref](./0003-データ形式の選択.md)）、R や Python からアクセスする際には、ユーザーが Parquet 形式を意識せずに利用できるようにしたい。
また、R や Python のユーザーにデータベースについても知ってほしいという教育目的があるため、SQL クライアントライブラリを使って DB に接続する方法で提供したい。

## Decision

ブラウザ分析環境のスタートアップ時に DuckDB データベースを初期化し、Parquet ファイルを読み込んでテーブルとして提供する。ユーザーは R や Python の SQL クライアントライブラリ（duckdb パッケージ）を使って接続し、SQL クエリを実行できる。

## Consequences

- **メリット**
  - ユーザーが SQL クライアントライブラリの使い方を学べる
  - データベースの概念を理解できる
  - SQL クエリで柔軟にデータを操作できる
  - Parquet 形式を意識せずに利用できる
  - 実装がシンプルで容易（DuckDB は Parquet ファイルを直接読み込める）
- **デメリット**
  - 初期化時にデータベース接続のセットアップが必要
  - メモリ使用量が増える可能性（ただし、データサイズが 5MB 程度なので問題なし）
  - データが大きい場合、初期化に時間がかかる可能性

## 実装方針

- WebR（R）: 初期化時に `duckdb` パッケージを使用して DuckDB データベースに接続し、Parquet ファイルをテーブルとして読み込む。接続オブジェクトを `con` という変数名で提供し、テーブル名は `ctd_data` とする。
- Pyodide（Python）: 初期化時に `duckdb` パッケージを使用して DuckDB データベースに接続し、Parquet ファイルをテーブルとして読み込む。接続オブジェクトを `con` という変数名で提供し、テーブル名は `ctd_data` とする。
- ユーザーは `con` を使って SQL クエリを実行し、`SELECT * FROM ctd_data` のようにテーブルにアクセスできる

